import streamlit as st

# 1. 페이지 설정 (공식 명칭 반영)
st.set_page_config(page_title="제재처분 예방 자가진단", page_icon="⚖️", layout="wide")

# 요청하신 제목으로 변경 완료
st.title("⚖️ 국가연구개발사업 제재처분 예방 자가진단 시스템")
st.markdown("##### 과학기술정보통신부 및 KISTEP 표준 프로세스 가이드 기반 [v6.0]")

# 2. 진단 섹션: 전문기관 노하우 반영 (취조가 아닌 현상 진단)
with st.container():
    st.info("💡 본 시스템은 「국가연구개발사업 제재처분 표준 프로세스」에 의거하여, 제재 사유를 사전에 예방하고 최적의 구제 절차를 안내합니다.")
    
    col1, col2 = st.columns(2)
    
    with col1:
        st.subheader("💰 연구비 집행 및 관리 패턴")
        # RCMS/Ezbaro 모니터링 기준 및 감사 지적 사항 반영
        q1 = st.selectbox("1. 특정 업체와의 거래 비중이 비정상적으로 높거나 독점적입니까?", ["아니오", "예"])
        q2 = st.selectbox("2. 연구비 카드 결제 취소 후 시스템상 미처리(반납 지연) 내역이 있습니까?", ["아니오", "예"])
        q3 = st.selectbox("3. 학생인건비를 회수하여 연구실 공동 경비로 관리(풀링)하고 있습니까?", ["아니오", "예"])

    with col2:
        st.subheader("📋 성과 소유 및 재무 건전성")
        # 혁신법 및 참여제한 기준 반영
        q4 = st.selectbox("4. 연구개발 성과(특허 등)를 기관이 아닌 개인 명의로 출원/등록했습니까?", ["아니오", "예"])
        q5 = st.selectbox("5. 참여연구원 중 타 과제에서 참여제한 처분을 받은 이력이 있습니까?", ["아니오", "예"])
        q6 = st.selectbox("6. 현재 기업의 부채비율이 500% 이상이거나 자본잠식 상태입니까?", ["아니오", "예"])

# 3. 추가 진단 (감면/유예 대상 여부)
st.markdown("---")
st.subheader("📉 징수 유예 및 감면 대상 확인")
q7 = st.checkbox("현재 경영악화, 부도, 폐업 등 불가피한 사유로 환수금 일시 납부가 어렵습니까?")

# 4. 분석 및 솔루션 출력
if st.button("🚀 진단 결과 및 행정 솔루션 확인"):
    # 리스크 로직 (가이드라인 기반)
    is_critical = any([q1=="예", q3=="예", q4=="예", q5=="예"]) # 고의성, 중대성 높은 항목
    is_warning = any([q2=="예", q6=="예"]) # 행정 미숙, 재무 이슈
    
    st.divider()
    st.markdown("### 📊 진단 결과 리포트")

    if is_critical:
        st.error("🚨 [위험] '제재처분평가단' 상정 대상 가능성이 높습니다.")
        
        # 1. 상세 리스크 분석
        with st.expander("📍 리스크 발생 근거 (표준 매뉴얼 참조)"):
            st.write("- **연구비 유용/횡령**: 학생인건비 유용 등은 참여제한 및 제재부가금(최대 5배) 부과 사유입니다.")
            st.write("- **협약 위반**: 참여제한 인력의 과제 참여나 성과 개인 소유는 중대한 협약 위반 사항입니다.")
        
        # 2. 행정 솔루션 (표준 프로세스 기반)
        st.markdown("#### 💡 사업조정실 제안 솔루션 (Solution)")
        st.success("**1. 소명 기회 활용**: 평가단 개최 시 출석하여 위반의 고의성이 없음을 입증하십시오. (발표 10분, 질의응답 20분 부여)")
        st.success("**2. 재검토 요청**: 제재처분 사전통지 후 20일 이내에 '연구자권익보호위원회' 또는 '소관 중앙행정기관'에 재검토를 요청할 수 있습니다.")

    elif is_warning:
        st.warning("⚠️ [주의] 행정 보완 및 재무 모니터링이 필요합니다.")
        
        with st.expander("📍 리스크 발생 근거 (표준 매뉴얼 참조)"):
            st.write("- **상시 점검 대상**: 카드 취소 미처리나 부채비율 급증은 회계법인 및 전문기관의 집중 모니터링 대상입니다.")
            st.write("- **평가 불이익**: 재무 건전성 악화는 차기 과제 선정이나 연차 평가 시 감점 요인이 될 수 있습니다.")

        st.markdown("#### 💡 사업조정실 제안 솔루션 (Solution)")
        st.success("**1. 전문가 컨설팅**: 사업조정실 및 위탁 정산 회계법인을 통해 소명 자료를 사전 구비하십시오.")
        st.success("**2. 연구비 시스템 교육**: RCMS/Ezbaro 사용법 교육을 이수하여 단순 행정 실수를 방지하십시오.")

    else:
        st.success("✅ [안전] 현재 행정 리스크가 발견되지 않았습니다.")
        st.balloons()
        st.info("2026 전략기술 사업화 과제(AI 빅테크 등) 참여를 적극 권장합니다.")

    # 3. 징수 유예 가이드 (감면 대상 체크 시)
    if q7:
        st.markdown("---")
        st.info("ℹ️ **[징수 특례 안내]** 경영악화 입증 시 환수금 납부 기한을 **최대 5년 범위 내에서 유예**하거나 분할 납부할 수 있습니다.")
