import streamlit as st

# 1. 페이지 설정
st.set_page_config(page_title="R&D Compliance Partner", page_icon="⚖️", layout="wide")

st.title("⚖️ 2026 R&D 행정리스크 예방·구제 네비게이션")
st.markdown("##### 과기정통부 표준 매뉴얼 및 전문기관(NRF, TIPA, KAIA 등) 운영 노하우 반영")

# 2. 진단 섹션: 취조가 아닌 '현상 확인' 위주로 구성
with st.container():
    st.info("💡 본 진단은 연구 수행 중 발생할 수 있는 행정적 착오를 방지하고, 최적의 구제 절차를 안내하기 위해 설계되었습니다.")
    
    col1, col2 = st.columns(2)
    
    with col1:
        st.subheader("💰 연구비 집행 패턴 분석")
        # RCMS/Ezbaro 모니터링 기준 반영
        q1 = st.selectbox("1. 특정 업체와의 거래 비중이 전체 연구비의 50%를 초과합니까?", ["아니오", "예"])
        q2 = st.selectbox("2. 연구비 카드 결제 후 취소 내역이 시스템상에 미처리 상태로 남아있습니까?", ["아니오", "예"])
        q3 = st.selectbox("3. 학생인건비 지급 후 연구실 운영비 명목의 공동 관리 계좌가 존재합니까?", ["아니오", "예"])

    with col2:
        st.subheader("📋 성과 및 인력 컴플라이언스")
        # 혁신법 및 참여제한 기준 반영
        q4 = st.selectbox("4. 연구개발성과(특허 등) 출원 시 연구자 개인 또는 대표자 명의가 포함되었습니까?", ["아니오", "예"])
        q5 = st.selectbox("5. 참여연구원 중 타 부처 과제에서 참여제한을 받은 이력이 있는 분이 계십니까?", ["아니오", "예"])
        q6 = st.selectbox("6. 현재 기업의 부채비율이 500%를 초과하거나 자본잠식 상태에 해당합니까?", ["아니오", "예"])

# 3. 분석 및 솔루션 출력
if st.button("🚀 정밀 진단 결과 및 전문가 솔루션 확인"):
    # 가점/감점 및 리스크 카테고리 분류
    is_critical = any([q1=="예", q3=="예", q5=="예"])
    is_warning = any([q2=="예", q4=="예", q6=="예"])
    
    st.divider()
    st.markdown("### 📊 맞춤형 행정 리포트")

    if is_critical:
        st.error("🚨 [중점 관리 대상] 형사적 리스크 및 참여제한 가능성이 감지되었습니다.")
        
        # 1. 근거 설명 (왜 문제가 되는가?)
        with st.expander("📍 리스크 발생 근거 (전문가 의견)"):
            st.write("* **연구비 유용 의심**: 특정 업체 집중 거래 및 인건비 공동 관리는 과기정통부 표준 매뉴얼상 '중점 적발 대상'입니다.")
            st.write("* **참여제한 리스크**: 타 부처 처분 이력이 있는 연구원 참여는 혁신법 제32조 위반으로 과제 중단 사유가 됩니다.")
        
        # 2. 솔루션 (어떻게 해결해야 하는가?)
        st.markdown("#### 💡 사업조정실 제안 솔루션 (Solution)")
        st.success("**1. 자진 신고 및 수정**: 행정처분 확정 전, 오집행 내역을 자진 신고하고 연구비 정산 시 자발적으로 반납하여 처분 수위를 낮추십시오.")
        st.success("**2. 소명 기회 확보**: 제재처분평가단 개최 시 30분 내외의 소명 기회를 활용하여 '비의도성'과 '성실 수행'을 입증하십시오.")
        st.success("**3. 재검토 회의 신청**: 사전통지 후 20일 이내에 '연구자권익보호위원회'에 재검토를 요청하여 객관적인 재심사를 받으십시오.")

    elif is_warning:
        st.warning("⚠️ [예방 관리 대상] 행정 보완 및 정밀 모니터링이 권장됩니다.")
        
        with st.expander("📍 리스크 발생 근거 (전문가 의견)"):
            st.write("* **행정 미숙**: 카드 취소 미처리 및 성과 소유권 일탈은 정산 단계에서 '불인정 금액 회수'의 주된 원인입니다.")
            st.write("* **재무 건전성**: 부채비율 초과는 전문기관의 상시 모니터링 대상이며, 선정/연차 평가 시 탈락 리스크를 높입니다.")

        st.markdown("#### 💡 사업조정실 제안 솔루션 (Solution)")
        st.success("**1. 1:1 맞춤형 컨설팅 신청**: 재단 지정 회계법인을 통해 비목 변경 및 증빙 보완 가이드를 즉시 받으십시오.")
        st.success("**2. 징수 유예 검토**: 경영악화 시 환수금 및 제재부가금을 최대 5년까지 분할 납부하거나 유예할 수 있는 제도를 활용하십시오.")

    else:
        st.success("✅ [무결함] 현재 행정 리스크가 발견되지 않았습니다.")
        st.balloons()
